syntax = "proto3";

package protos;

import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";
import "whatsappweb.proto";

option go_package = "github.com/digital-witness-lab/whatup/protos";


service WhatUpCore {
    rpc GetConnectionStatus(google.protobuf.Empty) returns (ConnectionStatus) {}
    rpc GetMessage(google.protobuf.Empty) returns (stream WUMessage) {}
    rpc DownloadMedia(MediaInfo) returns (Media) {}
}

message JID {
    string user = 1;
    uint32 agent = 2;
    uint32 device = 3;
    uint32 server = 4;
    uint32 ad = 5;
}

message ConnectionStatus {
    bool isConnected = 1;
    bool isLoggedIn = 2;
    google.protobuf.Timestamp timestamp = 3;
}

message WUMessage {
    MessageInfo info = 1;
    MessageContent content = 2;
    MessageProperties messageProperties = 3;

    whatsappweb.Message originalMessage = 4;
}

message MessageSource {
    JID chat = 1;
    JID sender = 2;
    JID broadcastListOwner = 3;

    bool isFromMe = 4;
    bool isGroup = 5;
}

message MessageInfo {
    MessageSource source = 1;
    google.protobuf.Timestamp timestamp = 2;
    string id = 3;
    string pushName = 4;
    string type = 5; // TODO: turn into enum!

    string category = 6; // TODO: turn into enum!
    bool multicast = 7;
}

message MessageContent {
    string title = 1;
    string text = 2;

    map<string, string> properties = 3;
    bytes thumbnail = 4;
    MediaInfo mediaInfo = 5;
}

message MessageProperties {
    bool isEphemeral = 1;
    bool isViewOnce = 2;
    bool isDocumentWithCaption = 3;
    bool isEdit = 4;
    uint32 forwardedScore = 5;
}

message MediaInfo {
    enum MediaType {
        NONE = 0;
        IMAGE = 1;
        VIDEO = 2;
    }
    map<string, bytes> locator = 1;
    MediaType mediaType = 3;
    string mimeType = 4;
}

message Media {
    bytes Contents = 1;
}
