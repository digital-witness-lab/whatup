<html>
    <head>
        <title>Select the groups for WhatsApp Watch</title>
<style>
body {{
    padding: 5vh 5vw;
    font-size: 2rem;
    background-color: #f5f3e9;
}}

input {{
    width: 3em;
    height: 3em;
    accent-color: #4CAF50;
}}

hr {{
    margin: 3em 0;
}}

li {{
    list-style-type: none;
}}

li:not(:last-child) {{ 
   margin-bottom: 2rem;  
}}

.group-name {{
    font-weight: bold;
}}

.group-topic:not(:empty)::before {{
    content: "- "
}}

.group-participants {{
    font-size: 0.5em;
    font-style: italic;
}}

.center {{
    text-align: center;
}}

#submit-button {{
    margin-top: 2em;
    background-color: #4CAF50;
    border: none;
    color: white;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 2em;
}}

.logo {{
    width: 60vw;
    margin-bottom: 3em;
}}

.search {{
    width: 100%;
    font-size: 1em;
    margin-bottom: 2em;
}}

</style>
    </head>
    <body>

        <div class="center">
<svg class="logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72.32 48.93" xmlns:v="https://vecta.io/nano"><path d="M16.1.6h4.7c5 0 7.2 2.7 7.2 7 0 4.5-2.3 7.5-7.5 7.5h-4.4V.6zm9.5 7.3c0-4.1-1.8-5.4-5-5.4h-2.2v10.7h2c3.7 0 5.2-2 5.2-5.3zm5-4.9c-.9 0-1.5-.5-1.5-1.5S29.7 0 30.6 0c1 0 1.5.5 1.5 1.5S31.5 3 30.6 3zm-1.2 12.1V4.8h2.3v10.4h-2.3zm11.4-9.7c.4-.8 1-1.4 1.7-1.4.3 0 .5 0 .8.1v1.5c-.6 0-1.4 0-1.9.2.6.6.9 1.5.9 2.4 0 2.3-1.9 3.7-4.4 3.7-.7 0-1.3-.1-1.8-.2-.3.2-.5.5-.5.8 0 .4.2.6 1.1.7l3 .2c2.2.1 3.5.8 3.5 2.7 0 2.7-2.6 3.6-5.4 3.6-3.9 0-4.8-1.3-4.8-2.6 0-1.1.8-1.8 1.7-2.1v-.1c-.8-.3-1.2-.8-1.2-1.6 0-.9.7-1.5 1.5-2.1-.9-.5-1.5-1.5-1.5-2.9 0-2.2 1.7-3.8 4.5-3.8 1.1.1 2.1.3 2.8.9zm-1.5 10.1l-3.3-.2c-.5.4-.9.8-.9 1.4 0 .8.7 1.3 2.7 1.3s3-.4 3-1.4c0-.6-.2-1.1-1.5-1.1zM38 6.3c-1.3 0-2.3.6-2.3 1.9 0 1.2.7 1.9 2.3 1.9 1.3 0 2.2-.7 2.2-1.9s-.8-1.9-2.2-1.9zM45.6 3c-.9 0-1.5-.5-1.5-1.5S44.7 0 45.6 0c1 0 1.5.5 1.5 1.5.1 1-.5 1.5-1.5 1.5zm-1.1 12.1V4.8h2.3v10.4h-2.3zm8 .3c-2 0-3.1-.9-3.1-3.1V6.5h-1.6V4.8h1.6v-3l2.3-.3v3.4h2.8v1.7h-2.8v5.5c0 1 .3 1.6 1.4 1.6.6 0 1.3-.2 1.8-.5l.4 1.6c-.6.2-1.7.6-2.8.6zm12.1-1.6c.2 0 .4 0 .6-.1l.1 1.4c-.4.2-1.1.3-1.6.3-1.1 0-1.6-.4-1.7-1.2-.7.8-1.8 1.3-3.3 1.3-2.6 0-3.1-1.8-3.1-2.8 0-2.7 2.3-3.6 5.1-3.6h1.1v-.8c0-1.3-.3-2-1.8-2-1.3 0-1.7.5-1.9 1.6l-2-.4c.3-1.9 1.6-3 4.1-3 2.6 0 3.9 1 3.9 3.6V13c-.2.5-.1.8.5.8zm-3.9-3.2c-1.2 0-2.8.1-2.8 1.7 0 .7.3 1.4 1.5 1.4.9 0 1.8-.5 2.3-1v-2c-.2-.1-.4-.1-1-.1zm5.4 4.5V0h2.3v15.1h-2.3zM9 20.7h0L6.2 31.9h-3L0 17.3h2.5l2.3 11.9h0l2.9-11.9h2.5l3 12h0l2.2-12h2.3l-3.1 14.5h-3L9 20.7zm11.2-.9c-.9 0-1.5-.5-1.5-1.5s.6-1.5 1.5-1.5c1 0 1.5.5 1.5 1.5 0 .9-.5 1.5-1.5 1.5zM19 31.9V21.5h2.3v10.4H19zm8.3.2c-2 0-3.1-.9-3.1-3.1v-5.8h-1.6v-1.7h1.6v-3l2.3-.3v3.4h2.8v1.7h-2.8v5.5c0 1 .3 1.6 1.4 1.6.6 0 1.3-.2 1.8-.5l.4 1.6c-.6.2-1.7.6-2.8.6zm10.4-.2v-6.7c0-1.3-.5-2-1.7-2-1 0-2.1.6-2.6 1.1v7.6H31V21.5h2l.1 1.1c.9-.7 2.2-1.3 3.6-1.3 2.2 0 3.2 1.2 3.2 3.5v7.1h-2.2zm3.5-5.2c0-3.8 2.2-5.4 5-5.4 3 0 4.3 1.9 4.3 4.6 0 .4 0 .9-.1 1.4h-6.7c.1 2.2 1.1 3 2.6 3 1.3 0 1.9-.6 2.1-1.7l2 .5c-.4 2-2 3.1-4.2 3.1-3.9-.1-5-2.7-5-5.5zm4.8-3.6c-1.2 0-2.2.7-2.3 2.5H48c0-1.7-.6-2.5-2-2.5zm13.6 1.1l-2 .5c-.2-1-.6-1.7-2-1.7-1.3 0-1.8.5-1.8 1.2 0 1 .9 1.2 2.2 1.5 1.8.3 3.7.7 3.7 3.1 0 2.1-1.7 3.3-4.3 3.3-2.5 0-3.9-1-4.2-2.9l2-.6c.3 1 .7 1.8 2.3 1.8 1.1 0 1.9-.4 1.9-1.2 0-1-.8-1.2-2.2-1.5-1.7-.3-3.7-.7-3.7-3.2 0-2.2 1.8-3.2 4-3.2 2.6 0 3.7 1.1 4.1 2.9zm9.3 0l-2 .5c-.2-1-.6-1.7-2-1.7-1.3 0-1.8.5-1.8 1.2 0 1 .9 1.2 2.2 1.5 1.8.3 3.7.7 3.7 3.1 0 2.1-1.7 3.3-4.3 3.3-2.5 0-3.9-1-4.2-2.9l2-.6c.3 1 .7 1.8 2.3 1.8 1.1 0 1.9-.4 1.9-1.2 0-1-.8-1.2-2.2-1.5-1.6-.4-3.5-.7-3.5-3.2 0-2.2 1.8-3.2 4-3.2 2.4 0 3.5 1.1 3.9 2.9zM48.2 46.6v2h-8.8V34.1h2.3v12.5h6.5zm9.7.6c.2 0 .4 0 .6-.1l.1 1.4c-.4.2-1.1.3-1.6.3-1.1 0-1.6-.4-1.7-1.2-.7.8-1.8 1.3-3.3 1.3-2.6 0-3.1-1.8-3.1-2.8 0-2.7 2.3-3.6 5.1-3.6h1.1v-.8c0-1.3-.3-2-1.8-2-1.3 0-1.7.5-1.9 1.6l-2-.4c.3-1.9 1.6-3 4.1-3 2.6 0 3.9 1 3.9 3.6v4.8c-.2.7-.1.9.5.9zM54 44.1c-1.2 0-2.8.1-2.8 1.7 0 .7.3 1.4 1.5 1.4.9 0 1.8-.5 2.3-1v-2c-.2-.1-.4-.1-1-.1zm5.5-10.7h2.3v5.8c.9-.8 1.9-1.2 3.4-1.2 2.1 0 3.8 1.4 3.8 5.2 0 4.1-1.9 5.7-4.3 5.7-1.3 0-2.2-.5-2.9-1.1h0l-.1.9h-2V33.4zm4.6 13.5c1.7 0 2.4-1.3 2.4-3.7 0-2.1-.6-3.3-2.2-3.3-1 0-2 .6-2.5 1.1v5c.4.3 1.3.9 2.3.9zm6.8 1.9c-.9 0-1.4-.4-1.4-1.3s.5-1.3 1.4-1.3 1.4.5 1.4 1.3-.5 1.3-1.4 1.3z"/><path d="M4.6 36.5h31.7v1.4H4.6z" fill="#e4022a"/></svg>
        </div>
        <div>
            Select the groups below that you give consent for our systems to
            read. This means that our system will be able to read past and
            future messages within the group. Keep in mind that we do not store
            usernames, phone numbers or real names.
        </div>

        <hr>

        <input type="text" class="search" oninput="displayList(this.value)" placeholder="Filter groups" />
        <div id="group-list"></div>
        <div class="center">
            <button id="submit-button">Submit</button>
        </div>

        <script>
            const userServicesBot = "{bot_number}";
            const gid_nbytes = {gid_nbytes};  // number of bytes from the hashed group JID that were used in the gid
            const data = {data_jsons};

        
            const groupList = document.getElementById('group-list');
            // Render the JSON data as a list
            function displayList(filter) {{
                groupList.innerHTML = '';
                data.sort((a, b) => a.n_participants < b.n_participants);
                data.forEach(item => {{
                    if (filter && !(item.name.toLocaleLowerCase().includes(filter) || item.topic.toLocaleLowerCase().includes(filter))) {{
                        return;
                    }}
                    const listItem = document.createElement('li');
                    const checked = item.can_read ? 'checked' : ''
                    listItem.innerHTML = `
                <label>
                  <input type="checkbox" class="group-checkbox" data-gid="${{item.gid}}" data-initial="${{item.can_read}}" ${{checked}}>
                  <span class="group-name">${{item.name}}</span> <span class="group-topic">${{item.topic}}</span> <span class="group-participants">(${{item['n_participants']}} participants)</span>
                </label>
                    `;
                    groupList.appendChild(listItem);
                }});
            }}
            displayList()
        
            // Handle form submission
            const submitButton = document.getElementById('submit-button');
            submitButton.addEventListener('click', () => {{
                const selectedGroups = [];
                const checkboxes = document.querySelectorAll('.group-checkbox');
        
                checkboxes.forEach(checkbox => {{
                    const gid = checkbox.getAttribute('data-gid');
                    const checked_initial = checkbox.getAttribute('data-initial') == "true";
                    if (checked_initial ^ checkbox.checked) {{
                        selectedGroups.push(`${{gid}}|${{Number(checkbox.checked)}}`)
                    }}
                }});
                
                var serializedResp = selectedGroups.join(':');
                window.location = `https://api.whatsapp.com/send?phone=${{userServicesBot}}&text=setacl-${{gid_nbytes}}@${{serializedResp}}`
            }});
        </script>
    </body>
</html>
